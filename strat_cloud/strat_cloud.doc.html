<HTML>
<TITLE>module strat_cloud</TITLE>
<BODY BGCOLOR="#AABBCC" TEXT="#332211" >

<DIV ALIGN="CENTER"> <FONT SIZE=1>
<A HREF="#INTERFACE">PUBLIC INTERFACE</A> / 
<A HREF="#ROUTINES">ROUTINES</A> / 
<A HREF="#NAMELIST">NAMELIST</A> / 
<A HREF="#CHANGES">CHANGES</A> / 
<A HREF="#ERRORS">ERRORS</A> / 
<A HREF="#REFERENCES">REFERENCES</A> / 
<A HREF="#NOTES">NOTES</A> 
</FONT>
<BR><BR></DIV><HR>


<H2>Module Strat_Cloud</H2>
<A NAME="HEADER">
<PRE>
     <B>Contact:</B>   Steve Klein
     <B>Reviewers:</B>

     <B><A HREF=".doc.log#strat_cloud.f90">Tags/Status</A></B>
</PRE>
</A><!-- END HEADER -->
<!--------------------------------------------------------------------->
<A NAME="OVERVIEW">
<HR>
<H4>OVERVIEW</H4>
<!-- BEGIN OVERVIEW -->
<PRE>

     The prognostic scheme returns the time tendencies of liquid,
     ice, and saturated volume fraction (i.e. cloud fraction) that 
     are suspended in stratiform clouds. The scheme also returns the 
     temperature and water vapor tendencies due to the parameterized 
     large-scale condensation and evaporation. Finally, the scheme 
     diagnoses the fluxes of stratiform rain and snow that reach 
     the surface.

</PRE>
</A><!-- END OVERVIEW -->
<!--------------------------------------------------------------------->
<A NAME="DESCRIPTION">
<!-- BEGIN DESCRIPTION -->
<PRE>

     The prognostic cloud scheme is responsible for determing
     cloud volume fractions, condensed water tendencies, and
     the stratiform precipitation rate.  It includes processes
     for evaporation, condensation, deposition, and sublimation
     of cloud water, conversion of cloud water to precipitation,
     evaporation of falling precipitation, the bergeron-findeisan
     process, freezing of cloud liquid, accretion of cloud water
     by precipitation, and melting of falling precipitation.
     
     This scheme is based on the experience the author had 
     at the ECMWF in 1997. 

     A full description can be found <A HREF="strat_cloud.tech.ps">here</A>.

</PRE>
</A><!-- END DESCRIPTION -->
<!--------------------------------------------------------------------->
<A NAME="MODULES_USED">
<HR>
<H4>OTHER MODULES USED</H4>
<!-- BEGIN MODULES_USED -->
<PRE>

sat_vapor_pres_mod
utilities_mod
constants_mod
cloud_rad_mod     

</PRE>
</A><!-- END MODULES_USED -->
<!--------------------------------------------------------------------->
<A NAME="INTERFACE">
<HR>
<H4>PUBLIC INTERFACE</H4>
<!-- BEGIN INTERFACE -->
<PRE>

use strat_cloud_mod [,only: strat_init, strat_driv, strat_end,
                      add_strat_tend, subtract_strat_tend, 
                      strat_cloud_sum, strat_cloud_avg, do_strat_cloud]

strat_init -          called once to initialize strat_cloud, and 
                      cloud_rad module.  This routine also reads namelist
                      input and restart file.  It must be called before 
                      strat_driv

strat_driv -          called every time step to compute adjustments to 
                      the temperature and specific humidity, and cloud 
                      liquid, ice and fraction fields from large-scale 
                      condensation and convective detrainment.

strat_end  -          called at the end of the model run to terminate the
                      strat_cloud module and to write restart data

add_strat_tend -      This subroutine adds a field to the global storage 
                      field radturbten which holds the sum of the
                      radiation and turbulence tendencies.

subtract_strat_tend - This subroutine subtracts a field to the global 
                      storage field radturbten which holds the sum of 
                      the radiation and turbulence tendencies.

strat_cloud_sum -     Time averages or stores the instantaneous values of
                      the cloud fields for use in the radiation scheme.

strat_cloud_avg -     Averages or returns the instanteous cloud fields to
                      the radiation driver.  

do_strat_cloud -      A logical function indicating if True that the 
                      strat_cloud scheme is being used.

Notes:

 1) A namelist interface controls runtime options and selects fields
    for diagnostics output.
 2) A restart file is generated by this module.
 3) No other data files are needed.

</PRE>
</A><!-- END INTERFACE -->
<!--------------------------------------------------------------------->
<A NAME="ROUTINES">
<HR>
<H4>PUBLIC ROUTINES</H4>
<!-- BEGIN ROUTINES -->
<PRE>

<b>call strat_cloud_init</b> (IDIM,JDIM,KDIM)

input
    
   
     IDIM,JDIM      number of points in first and second horizontal
                    dimensions [integer]

     KDIM           number of points in vertical dimension [integer]


-----------------------------------------------------------------------

<b>call strat_driv</b> (is,ie,js,je,dtcloud,pfull,phalf,T,qv,ql,qi,qa,
                      omega,Mc,LAND,ST,SQ,SL,SI,SA,surfrain,surfsnow,
                      MASK)


input
 
     is,ie      starting and ending i indices for window 
                [integer]

     js,je      starting and ending j indices for window 
                [integer]

     dtcloud    time between this call and the next call to strat_driv
                {seconds} 
                [real]

     pfull      pressure at full model levels {Pascals}. 
                [real,dimension(:,:,nlev)] 
                IMPORTANT NOTE: p(j) < p(j+1)

     phalf      pressure at half model levels {Pascals}.  
                [real,dimension(:,:,nlev+1)]
                IMPORTANT NOTE: phalf(j) < pfull(j) < phalf(j+1)

     T          temperature  {Kelvin} 
                [real,dimension(:,:,nlev)]

     qv         specific humidity of water vapor {kg vapor/kg air}
                [real,dimension(:,:,nlev)]
  
     ql         specific humidity of cloud liquid {kg vapor/kg air}
                [real,dimension(:,:,nlev)]
  
     qi         specific humidity of cloud ice {kg vapor/kg air}
                [real,dimension(:,:,nlev)]
  
     qa         cloud fraction {fraction} 
                [real,dimension(:,:,nlev)]
  
     omega      vertical pressure velocity  {Pascals/second}
                [real,dimension(:,:,nlev)]
  
     Mc         cumulus mass flux from convection scheme defined
                on model half levels {kg/(meters**2)/second}
                [real,dimension(:,:,nlev+1)]
    
     LAND       the fraction of the grid box containing land 
                {fraction}
                [real, dimension(:,:)]


output

     ST         temperature change (i.e. increment) due to stratiform
                processes {Kelvin} 
                [real,dimension(:,:,nlev)]


     SQ         water vapor specific humidity change due to stratiform 
                processes {kg vapor/kg air} 
                [real,dimension(:,:,nlev)]

     SL         cloud liquid specific humidity change due to stratiform 
                processes {kg vapor/kg air} 
                [real,dimension(:,:,nlev)]

     SI         cloud ice specific humidity change due to stratiform 
                processes {kg vapor/kg air} 
                [real,dimension(:,:,nlev)]

     SA         cloud fraction change due to stratiform processes 
                {fraction} 
                [real,dimension(:,:,nlev)]

     surfrain   stratiform rain which falls through the bottom of the
                column over the time dtcloud 
                {kg condensate/(meters**2)}
                [real,dimension(:,:)]

     surfsnow   stratiform snow which falls through the bottom of the
                column over the time dtcloud 
                {kg condensate/(meters**2)}
                [real,dimension(:,:)]


optional input

     MASK       real array indicating the point is above the surface
                if equal to 1.0 and indicating the point is below
                the surface if equal to 0.
                [real,dimension(:,:,nlev)]


-----------------------------------------------------------------------

<b>call strat_end</b> ()

no arguments


-----------------------------------------------------------------------

<b>call add_strat_tend</b> (is,ie,js,je,tend)


input
 
     is,ie      starting and ending i indices for window 
                [integer]

     js,je      starting and ending j indices for window 
                [integer]

     tend       tendency of a physical field {Kelvin/second}
                [real,dimension(:,:,nlev)]


-----------------------------------------------------------------------

<b>call subtract_strat_tend</b> (is,ie,js,je,tend)


input
 
     is,ie      starting and ending i indices for window 
                [integer]

     js,je      starting and ending j indices for window 
                [integer]

     tend       tendency of a physical field {Kelvin/second}
                [real,dimension(:,:,nlev)]


-----------------------------------------------------------------------

<b>call strat_cloud_sum</b> (is, js, ql, qi, cf)


input
 
     is         starting i indices for window 
                [integer]

     js         starting j indices for window 
                [integer]

     ql         cloud liquid specific humidity {kg condensate/ kg air}
                [real,dimension(:,:,nlev)]

     qi         cloud ice specific humidity {kg condensate/ kg air}
                [real,dimension(:,:,nlev)]

     cf         cloud fraction {fraction}
                [real,dimension(:,:,nlev)]

  
-----------------------------------------------------------------------

<b>call strat_cloud_avg</b> (is, js, ql, qi, cf, ierr)


input
 
     is         starting i indices for window 
                [integer]

     js         starting j indices for window 
                [integer]


output

     ql         cloud liquid specific humidity {kg condensate/ kg air}
                [real,dimension(:,:,nlev)]

     qi         cloud ice specific humidity {kg condensate/ kg air}
                [real,dimension(:,:,nlev)]

     cf         cloud fraction {fraction}
                [real,dimension(:,:,nlev)]

     
     ierr       integer for error output.  If equal to 1 then the
                cloud storage has some points with zero counter. Thus
                dividing by the counter variable to form the mean
                cloud field is not possible. If equal to zero then 
                there is no error.
                [integer]


-----------------------------------------------------------------------

<b> function strat_cloud_avg</b> () 

result 

     answer     A logical function indicating if True that the 
                strat_cloud scheme is being used.
                [logical]




</PRE>
</A><!-- END ROUTINES -->
<!--------------------------------------------------------------------->
<A NAME="NAMELIST">
<HR>
<H4>NAMELIST</H4>
<!-- BEGIN NAMELIST -->
<PRE>

<b>&strat_cloud_nml</b>

     U00        threshold relative humidity for cloud formation by
                large-scale condensation {fraction}
                [real, default: U00 = 0.825]

     rthresh    liquid cloud drop radius threshold for autoconversion
                {microns}
                [real, default: rthresh = 10.]

     N_land     fixed number of cloud drops per unit volume in liquid 
                clouds over land {1/(meters**3)}
                [real, default: N_land = 6.E+08]

     N_ocean    fixed number of cloud drops per unit volume in liquid 
                clouds over non-land {1/(meters**3)}
                [real, default: N_ocean = 1.E+08]

     tau_berg   Time scale for cloud liquid to be converted to cloud 
                ice by the Bergeron-Findeisan mechanism {seconds}
                [real, default: tau_berg = 100.]

     rho_ice    assumed mass density of ice crystals 
                {kg condensate/(meters**3)}
                [real, default: rho_ice = 100.]
 
     ELI        collection efficiency of cloud liquid by falling ice
                {fraction}
                [real, default: ELI = 0.7]

     U_evap     critical relative humidity above which rain does not
                evaporate {fraction}
                [real, default: U_evap = 1.0]

     eros_scale  rate constant for destruction of cloud by turbulent
                 mixing with unsaturated air in the grid box {1/second}
                 [real, default: eros_scale = 1.E-06]
    
     tracer_advec  Are cloud liquid,ice and fraction advected by the
                   grid resolved motion? 
                   [logical, default: tracer_advec = .false.]

     qmin       minimum permissible value of cloud liquid, cloud ice,
                saturated volume fraction, or rain and snow areas.
                {kg condensate / kg air, or fraction}
                [real, default: qmin = 1.E-10]

     Dmin       minimum permissible dissipation in analytic integration 
                of qa, ql, qi equations. This constant ONLY affects the 
                method by which the prognostic equations are integrated.
                [real, default: Dmin = 1.E-08]

     do_average Should stratiform cloud properties be averaged before 
                computing clouds used by radiation?
                [logical, default: do_average = .false.]
        
     num_strat_pts  number of grid points where instantaneous output
                    will be saved to file strat.data.  Note that
                    num_strat_pts <= max_strat_pts, where the default
                    for max_strat_pts is 5.  The instantaneous
                    data output is the cloud liquid, cloud ice,
                    cloud fraction, temperature, and water vapor
                    fields after updating with the strat_cloud tendencies.
                    Also output are the i,j indices of the points,
                    and the pressure at full model levels.  See
                    the program for the order of output fields. 
                    [integer, default: num_strat_pts = 0]
 
     strat_pts      "num_strat_pts" pairs of grid indices, e.g., 
                    the global indices for i,j for which instantaneous
                    data is output.  
                    [integer, dimension(2,max_strat_pts), 
                     default: strat_pts = 0]

Notes:

 1) qmin should be chosen such that the range of {qmin, 1} is resolved 
    by the machine precision.
 2) Dmin will be MACHINE DEPENDENT and is needed to prevent case of
    1. -exp(-Dmin)  = 0.  instead of Dmin in the limit of very small Dmin.   
    Dmin is chosen such that the computer satisfies:
                 
                     1. - exp(-D) < D for all D > Dmin


</PRE>
</A><!-- END NAMELIST -->
<!--------------------------------------------------------------------->
<A NAME="CHANGES">
<HR>
<H4>CHANGE HISTORY</H4>
<!-- BEGIN CHANGES -->
<PRE>
<B><A HREF=".doc.log#strat_cloud.f90">CVS Revision history</A></B>

    On 6/15/00, from version 2.0 to version v2.1

    The primary change is incorporation of a new method for treating the
Bergeron process.  The old method was based on an ad-hoc formulation
of Steve Klein, whereas the new method is based upon the physical
arguments and derivation of Rotstayn (2000).  As a result, the namelist
parameter tau_berg no longer is present. The secondary change is a 
change of cloud and precipitation overlap assumption from maximum 
random to random for the precipitation transfers at level interfaces. 
The tertiary change is in the division of large-scale condensation/
evaporation into liquid and ice phases. The new formulism produces 
liquid only for all condensation, and evaporates liquid before ice.
A fourth change is that cloud ice will melt when the temperature is
greater that the Tfreeze not Tfreeze+2.

</PRE>
</A><!-- END CHANGES -->
<!--------------------------------------------------------------------->
<A NAME="ERRORS">
<HR>
<H4>ERROR MESSAGES</H4>
<!-- BEGIN ERRORS -->
<PRE>

strat_cloud_avg:

     input argument has the wrong size.  field passed to the routine
     does not have the correct dimensions.

</PRE>
</A><!-- END ERRORS -->
<!--------------------------------------------------------------------->
<A NAME="REFERENCES">
<HR>
<H4>REFERENCES</H4>
<!-- BEGIN REFERENCES -->

     <I> The saturation volume fraction formalism comes from: </I>

<PRE>
     Tiedtke, M., 1993: Representation of clouds in large-scale models.
     Mon. Wea. Rev., 121, 3040-3061.
</PRE>
     <I> The form of most of the microphysics follows: </I>
<PRE>
     Rotstayn, L., 1997: A physically based scheme for the treatment
     of stratiform clouds and precipitation in large-scale models.
     I: Description and evaluation of microphysical processes.
     Quart. J. Roy. Met. Soc. 123, 1227-1282.
</PRE>
</A><!-- END REFERENCES -->
<!--------------------------------------------------------------------->
<A NAME="NOTES">
<HR>
<H4>NOTES</H4>
<!-- BEGIN NOTES -->
<PRE>

    None.

</PRE>
</A><!-- END NOTES -->
<!--------------------------------------------------------------------->
<A NAME="PLANS">
<HR>
<H4>FUTURE PLANS</H4>
<!-- BEGIN PLANS -->
<PRE>

     Currently changes to run the scheme with two-time levels are not 
     built in.

</PRE>
</A><!-- END PLANS -->
<!--------------------------------------------------------------------->

<HR>
</BODY>
</HTML>
