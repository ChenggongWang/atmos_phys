<HTML>
<TITLE>module cloud_rad</TITLE>
<BODY BGCOLOR="#AABBCC" TEXT="#332211" >

<DIV ALIGN="CENTER"> <FONT SIZE=1>
<A HREF="#INTERFACE">PUBLIC INTERFACE</A> / 
<A HREF="#ROUTINES">ROUTINES</A> / 
<A HREF="#NAMELIST">NAMELIST</A> / 
<A HREF="#CHANGES">CHANGES</A> / 
<A HREF="#ERRORS">ERRORS</A> / 
<A HREF="#REFERENCES">REFERENCES</A> / 
<A HREF="#PLANS">PLANS</A> 
</FONT>
<BR><BR></DIV><HR>


<H2>Module Cloud_Rad_Mod</H2>
<A NAME="HEADER">
<PRE>
     <B>Contact:</B>   Steve Klein
     <B>Reviewers:</B>

     <B><A HREF=".doc.log#cloud_rad.f90">Tags/Status</A></B>
</PRE>
</A><!-- END HEADER -->
<!--------------------------------------------------------------------->
<A NAME="OVERVIEW">
<HR>
<H4>OVERVIEW</H4>
<!-- BEGIN OVERVIEW -->
<PRE>

     The cloud radiation module uses the stored values of the
     prognostic cloud variables, and computes the cloud albedo and
     absorption for the two shortwave bands (ultra-violet/visible and
     near-infrared), the longwave cloud emissivity, and the 
     fractional areas covered by clouds.

</PRE>
</A><!-- END OVERVIEW -->
<!--------------------------------------------------------------------->
<A NAME="DESCRIPTION">
<!-- BEGIN DESCRIPTION -->
<PRE>

     The cloud radiation module condenses the cloud information 
     provided by the stratiform cloud scheme and converts it into
     the areas covered by, the water paths and the effective particle 
     sizes of liquid and ice. This cloud information is stored into 
     cloud blocks which are assumed to be randomly overlapped (done 
     in CLOUD_ORGANIZE subroutine). From these, the single-scattering 
     albedo, asymmetry parameter, and optical depth for the two short 
     wave bands and the longwave cloud emissivity for each cloud are 
     calculated in the subroutine CLOUD_OPTICAL_PROPERTIES. Finally, 
     the subroutine CLOUD_RAD takes the shortwave cloud properties 
     and converts them using the Delta-Eddington solution to albedo 
     and absorption in each of the shortwave bands.

     In CLOUD_OPTICAL_PROPERTIES, the parameterization of Slingo (1989)
     and Ebert and Curry (1992) are used for the shortwave properties of 
     liquid and ice clouds, respectively.  For the longwave cloud 
     emissivity, the empirical observation result of Stephens (1978) is
     used for liquid clouds whereas the parameterization of Ebert and
     Curry (1992) is used for ice clouds.

     In CLOUD_ORGANIZE, the effective radius for liquid clouds is 
     calculated using the parameterization of Martin et al. (1994)
     whereas the effective radius of ice clouds is parameterized using
     that of Donner et al. (1997).

     The module has two important diagnostic subroutines. In 
     ISCCP_CLOUDTYPES, the satellite view of clouds is simulated for
     direct comparison to the ISCCP satellite data.  This allows one
     to quantify the occurrence of clouds stratified by their cloud
     top pressure and optical thickness.  The algorithm to do this
     is described fully in Klein and Jakob (1999).

     In TAU_REFF_DIAG the optical thickness of low clouds is diagnosed.
     In addition, the mean ice and liquid particle size from the cloud
     tops visible to a satellite (i.e. not obscured by higher level
     clouds) is diagnosed.

</PRE>
</A><!-- END DESCRIPTION -->
<!--------------------------------------------------------------------->
<A NAME="MODULES_USED">
<HR>
<H4>OTHER MODULES USED</H4>
<!-- BEGIN MODULES_USED -->
<PRE>

utilities_mod
constants_mod
diag_manager_mod
time_manager_mod

</PRE>
</A><!-- END MODULES_USED -->
<!--------------------------------------------------------------------->
<A NAME="INTERFACE">
<HR>
<H4>PUBLIC INTERFACE</H4>
<!-- BEGIN INTERFACE -->
<PRE>

use cloud_rad_mod [,only: cloud_rad_init, cloud_summary, cloud_rad]

cloud_rad_init -      called once to initialize cloud_rad module.  
                      This routine reads the namelist, registers
                      any requested diagnostic fields, and (when
                      called from strat_cloud_init [standard practice])
                      returns the overlap assumption to strat_cloud
                      for use in determining cloud and large-scale
                      precipitation overlap. 

cloud_summary -       called every radiation time step to return the
                      amounts covered by, and the longwave emissivity
                      of clouds predicted by the stratiform cloud
                      scheme.  In addition, if the Fels-Schwarzkopf
                      radiation code is being used, the module will
                      return the shortwave albedoes and absorptivities.
                      If the sea_esf radiation is being used, the 
                      code will return the concentrations of liquid
                      and ice and the effective particle diameters.

cloud_rad   -         this subroutine takes the optical depths, single
                      scattering albedoes, and asymmetry parameters in
                      the four shortwave bands (specified to in the
                      comments to cloud_optical_properties subroutine),
                      and solves the delta-eddington radiative transfer
                      code to provide the albedoes and reflectivities
                      of the clouds in 2 shortwave bands, the ultraviolet-
                      visible and the near infrared.

Notes:

 1) Note that if strat_cloud is operating, cloud_rad_init is called 
    from strat_cloud_init. This is done for two reasons.  First, this
    allows strat_cloud to initialize the values of three parameters
    (qmin, N_land, N_ocean) so that the values of these parameters
    in cloud_rad is exactly the same as it is in strat_cloud.  Secondly,
    strat_cloud receives the value of the overlap assumption that is
    set in cloud_rad, so that the same overlap assumption can be used
    in strat_cloud for determining cloud and large-scale precipitation
    overlap.
 2) Although there is a cloud_rad_init, there is no cloud_rad_end module.
 3) No other data files are needed.

</PRE>
</A><!-- END INTERFACE -->
<!--------------------------------------------------------------------->
<A NAME="ROUTINES">
<HR>
<H4>PUBLIC ROUTINES</H4>
<!-- BEGIN ROUTINES -->
<PRE>

<b>call cloud_rad_init</b> (axes,Time,qmin_in,N_land_in,N_ocean_in,overlap_out)


optional input
    
       axes           axis integers for diagnostics [integer]

       Time           time type variable for diagnostics [time type]
     
       qmin_in        minimum permissible cloud liquid, ice to calculate
                      cloud radiative properties.  All clouds with specific
                      humidities less than qmin_in will be ignored and treated
                      as if they didn't exist. Note, qmin_in is determined
                      by the strat_cloud module; qmin is a namelist parameter
                      for strat_cloud. [real] {kg condensate/kg air}

       N_land_in      number of cloud drop per cubic meter over land [real]
                      {#/((meter)**3)}
       
       N_ocean_in     number of cloud drop per cubic meter over ocean [real] 
                      {#/((meter)**3)}
                      
                 
optional output

        overlap_out   integer indicating the overlap assumption being used 
                      [integer] (1 = maximum-random, 2 = random)

 
-----------------------------------------------------------------------

<b>call cloud_summary</b> (is,js,Time,&
                  LAND,ql,qi,qa,qv,pfull,phalf,TKel,coszen,skt,&
                  nclds,ktop,kbot,cldamt,&
                  r_uv,r_nir,ab_uv,ab_nir,em_lw,&
                  conc_drop,conc_ice,size_drop,size_ice)


input

     is,js      indices for model slab [integer]

     Time       time type variable for diagnostics [time type]

     land       fraction of the grid box covered by LAND [real,dimension(:,:)]

     ql         specific humidity of cloud liquid {kg vapor/kg air}
                [real,dimension(:,:,nlev)]
  
     qi         specific humidity of cloud ice {kg vapor/kg air}
                [real,dimension(:,:,nlev)]
  
     qa         cloud fraction {fraction} 
                [real,dimension(:,:,nlev)]
 
     qv         specific humidity of water vapor {kg vapor/kg air}
                [real,dimension(:,:,nlev)]
  
     pfull      pressure at full model levels {Pascals}. 
                [real,dimension(:,:,nlev)] 
                IMPORTANT NOTE: p(j) < p(j+1)

     phalf      pressure at half model levels {Pascals}.  
                [real,dimension(:,:,nlev+1)]
                IMPORTANT NOTE: phalf(j) < pfull(j) < phalf(j+1)

     TKel       temperature  {Kelvin} 
                [real,dimension(:,:,nlev)]

     coszen     cosine of the solar zenith angle [real,dimension(:,:)]

     skt        surface skin temperature {Kelvin} [real, dimension(:,:)]


input/output

     nclds      number of (random overlapping) clouds in column 
                [integer,dimension(:,:)]

     ktop       index of vertical level which contains the top of
                the i'th cloud in the column. [integer,dimension(:,:,i),
                where i = 1, nclds(:,:)]
    
     kbot       index of vertical level which contains the bottom of
                the i'th cloud in the column. [integer,dimension(:,:,i)]
    
     cldamt     horiztonal area amount of i'th cloud (fraction)
                [real,dimension(:,:,i)]

optional input/output

     [For Fels-Schwarzkopf radiation]

     r_uv       cloud reflectance in ultra-violet (uv) band of i'th cloud 
                (fraction) [real,dimension(:,:,i)]
     
     r_nir      cloud reflectance in the near-infrared (nir) band of i'th 
                cloud (fraction) [real,dimension(:,:,i)] 

     ab_uv      cloud absorptance in the uv band of i'th cloud 
                (fraction) [real,dimension(:,:,i)]

     ab_nir     cloud absorptance in the nir band of i'th cloud 
                (fraction) [real,dimension(:,:,i)]

     em_lw      longwave emissivity of the i'th cloud (fraction)
                [real,dimension(:,:,i)]

     [For sea-esf radiation]

     NOTE: The third index refers to i'th model level number, not the i'th
           cloud as in the output for Fels-Schwarzkopf radiation

     conc_drop  liquid cloud droplet mass concentration {grams/m3}
                [real,dimension(:,:,nlev)] 
 
     conc_drop  cloud ice mass concentration {grams/m3}
                [real,dimension(:,:,nlev)]  

     size_drop  effective diameter of liquid cloud droplets {microns}
                [real,dimension(:,:,nlev)]
   
     size_drop  effective diameter of ice cloud particles {microns}
                [real,dimension(:,:,nlev)]

-----------------------------------------------------------------------

<b>call cloud_rad</b> (tau,w0,gg,coszen,r_uv,r_nir,ab_uv,ab_nir)


input 

     tau        optical depth in 4 bands (dimensionless) 
                [real,dimension(:,:,i), where i = 1, nclds(:,:)]
     
     w0         single scattering albedo in 4 bands (dimensionless)
                [real,dimension(:,:,i)]

     gg         asymmetry parameter in 4 bands (dimensionless)
                [real,dimension(:,:,i)]

     coszen       cosine of the solar zenith angle [real,dimension(:,:)]


input/output 

     r_uv       cloud reflectance in ultra-violet (uv) band of i'th cloud 
                (fraction) [real,dimension(:,:,i)]
     
     r_nir      cloud reflectance in the near-infrared (nir) band of i'th 
                cloud (fraction) [real,dimension(:,:,i)] 

     ab_uv      cloud absorptance in the uv band of i'th cloud 
                (fraction) [real,dimension(:,:,i)]

     ab_nir     cloud absorptance in the nir band of i'th cloud 
                (fraction) [real,dimension(:,:,i)]


</PRE>
</A><!-- END ROUTINES -->
<!--------------------------------------------------------------------->
<A NAME="NAMELIST">
<HR>
<H4>NAMELIST</H4>
<!-- BEGIN NAMELIST -->
<PRE>

<b>&cloud_rad_nml</b>


       overlap        integer variable indicating which 
                      overlap assumption to use:
                      [integer]

                      overlap = 1. means condensate in 
                                   adjacent levels is 
                                   treated as part of 
                                   the same cloud

                                i.e. maximum-random overlap
                          
                      overlap = 2. means condensate in 
                                   adjacent levels is 
                                   treated as different 
                                   clouds

                                i.e. random overlap

                      overlap is used only if the stratiform
                      cloud scheme is operating
                         
       l2strem        logical variable indicating whether
                      what solution for cloud radiative
                      properties is being used.
                      [logical]
          
                      l2strem = T  2 stream solution
                      l2strem = F  Delta-Eddington solution

                      Note that IF l2strem = T then the 
                      solution does not depend on solar 
                      zenith angle

                      used in the radiative transfer 
                      solution module (cloud_rad)

       taucrit        critical optical depth for switching 
                      direct beam to diffuse beam for 
                      use in Delta-Eddington solution
                      [real]

                      used in the radiative transfer
                      solution module (cloud_rad)

       adjust_top     logical variable indicating whether 
                      or not to use the code which places 
                      the top and bottom of the cloud at 
                      the faces which are most in view from
                      the top and bottom of the cloud block.  
                      This is done to avoid undue influence 
                      to very small cloud fractions.  If 
                      true this adjustment of tops is 
                      performed; If false this is not 
                      performed.
                      [logical]

       scale_factor   Factor which multiplies actual cloud
                      optical depths to account for the
                      plane-parallel homogenous cloud bias
                      (e.g. Cahalan effect). [real]

       qamin          minimum permissible cloud fraction to calculate
                      radiative properties of the cloud.  Note that this
                      is different than qmin which is the minimum possible
                      liquid or ice specific humidity to calculate radiative
                      properties of the cloud. 

                      Thus for a cloud to exist in the eyes of cloud_rad
                      both the cloud fraction must exceed qamin, and
                      one or the other of cloud liquid and ice must
                      have a specific humidity in excess of qmin. 
                      Note qmin is controlled by the value of qmin set
                      by strat_cloud module where qmin is a namelist
                      variable. [real]
 

       ------------------------------------------------------------------

                         ISCCP CLOUD PROCESSING

    
       The following variables only apply if the ISCCP cloud view
       processing is done.  To turn on ISCCP cloud processing, you
       must request one of the diagnostic output fields from the
       diag_table.


       adjust_isccp_top_height

                      logical variable indicating whether 
                      or not to simulate 10.5 micron brightness
                      temperatures to adjust top heights according
                      to the emissivity of the cloud. 
                     
                      If TRUE:

                      then infrared brightness temperature are 
                      computed and cloud top pressures are adjusted 
                      
                      If FALSE:
                
                      reported cloud top pressures is the actual cloud 
                      top pressure in the model

       ncol           number of columns used in ISCCP cloud type
                      simulations
 
       isccp_taumin   minimum optical depth ISCCP can see

       emsfclw        assumed constant of longwave emissivity of
                      the surface (fraction)


Notes:

 1) Namelist parameters adjust_top, overlap, and scale_factor are 
    only used by the stratiform cloud scheme when it is operating.

</PRE>
</A><!-- END NAMELIST -->
<!--------------------------------------------------------------------->
<A NAME="DIAGNOSTICS">
<HR>
<H4>DIAGNOSTIC FIELDS</H4>
<PRE>
Diagnostic fields may be output to a netcdf file by specifying the
module name <b>cloud</b> and the desired field names (given below)
in file <b>diag_table</b>. See the documentation for diag_manager.
</PRE>
<!-- BEGIN DIAGNOSTICS -->
<PRE>

Diagnostic fields for module name: <b>cloud</b>

   field name   field description
   ----------   -----------------

   nisccp       frequency of sunlit times at the times of the radiation
                calculation at each point {fraction} [real,dimension(:,:)]

   pc#tau%      where # is a number from 1 to 7
                and   % is a number from 1 to 7
                {fraction} [real,dimension(:,:)]

                Thus there are 49 diagnostic fields of this type.  All
                of them are necessary to receive the complete decomposition
                of clouds visible from space into the ISCCP categories.

                The 7 cloud top pressure ("pc") categories and 7 optical
                depth ("tau") categories are defined as:

                pc #      pc range (mb)    tau %        tau range
                ----    ----------------   -----    ---------------------

                 1              pc < 180     1     0.0    < tau < taumin 
                 2        180 < pc < 310     2     taumin < tau < 1.3
                 3        310 < pc < 440     3     1.3    < tau < 3.6
                 4        440 < pc < 560     4     3.6    < tau < 9.4
                 5        560 < pc < 680     5     9.4    < tau < 23
                 6        680 < pc < 800     6     23     < tau < 60
                 7        800 < pc                 60     < tau

                What is saved in these diagnostics is the time mean of
                the area covered by clouds of this type when the sun is
                above the horizon. This is done so that the calculation 
                will mimic the ISCCP product which is broken down into 
                these categories only for sunlit places.

                NOTE:  TO DETERMINE THE MEAN AREA COVERED BY A CLOUD TYPE 
                       WHEN THE SUN IS ABOVE THE HORIZON YOU MUST DIVIDE
                       BY NISCCP:

                       area of cloud type pc#tau% =   pc#tau% / nisccp

   aice         fractional area of sunlit clouds seen from space whose cloud 
                top contains ice. {fraction} [real,dimension(:,:)]

   reffice      time mean ice effective radius of cloud tops visible from
                space including areas where there is no such cloud {microns} 
                [real,dimension(:,:)]

                NOTE:  THUS THE TIME MEAN CLOUD TOP EFFECTIVE RADIUS OF CLOUD 
                       TOPS WITH ICE VISIBLE FROM SPACE IS:

                       mean reffice  =    reffice /  aice
      
   aliq         fractional area of sunlit clouds seen from space whose cloud 
                top contains liquid. {fraction} [real,dimension(:,:)]

   reffliq      time mean cloud droplet effective radius of cloud tops 
                visible from space including areas where there is no such 
                cloud {microns} [real,dimension(:,:)]
   
                NOTE:  mean reffliq  =    reffliq / aliq

   alow         fractional area of sunlit clouds seen from space whose cloud 
                tops are low (pc > 680 mb). {fraction} [real,dimension(:,:)]

   tauicelow    time mean optical depth of ice for cloud tops visible from 
                space including areas where there is no such cloud {microns} 
                [real,dimension(:,:)]
  
   tauliqlow    time mean optical depth of liquid for cloud tops visible from 
                space including areas where there is no such cloud {microns} 
                [real,dimension(:,:)]
   
   tlaylow      time mean of the low level mean temperature (pc > 680 mb) 
                when low cloud tops are visible from space including times 
                where there is no such cloud {microns} 
                [real,dimension(:,:)]
      
   tcldlow      time mean of the cloud top temperature for cloud tops visible 
                from space including times where there is no such cloud 
                {microns}  [real,dimension(:,:)]
      
                NOTE:  mean tauicelow  =    tauicelow / alow
                       mean tauliqlow  =    tauliqlow / alow
                       mean tlaylow    =    tlaylow   / alow
                       mean tcldlow    =    tcldlow   / alow


</PRE>
</A><!-- END DIAGNOSTICS -->
<!--------------------------------------------------------------------->
<A NAME="CHANGES">
<HR>
<H4>CHANGE HISTORY</H4>
<!-- BEGIN CHANGES -->
<PRE>
<B><A HREF=".doc.log#cloud_rad.f90">CVS Revision history</A></B>


<B>Changes prior to CVS version control</B>

<b>changes</b> (10/4/1999)

     Reset cloud properties to zero where there is zero cloud amount.
     This was needed for reproducibility on different numbers of
     processors. Answers may change slightly.

<b>changes</b> (10/4/1999)

     MPP version created. Minor changes for open_file and Fortran
     write statements. Answers should reproduce the previous version.

<b>changes</b> (6/15/2000)

     There are two changes to cloud_rad.  First, all clouds with cloud
     fraction less than the namelist parameter qamin (default value 0.01)
     are removed from set to zero for purposes of calculation cloud radiative
     properties.  This is because the diffusive nature of the advection
     scheme creates very small cloud fraction clouds which have zero
     significance.  Second, to account for the plane-parallel cloud
     albedo bias, the optical depth is scaled by a namelist parameter
     scale_factor (default value 0.8).

</PRE>
</A><!-- END CHANGES -->
<!--------------------------------------------------------------------->
<A NAME="ERRORS">
<HR>
<H4>ERROR MESSAGES</H4>
<!-- BEGIN ERRORS -->
<PRE>

    Fatal crashes occur in initialization of the module if:

    1. overlap does not equal 1 or 2
    2. taucrit < 0.
    3. scale_factor < 0.
    4. qamin outside of the range of 0 to 1.

</PRE>
</A><!-- END ERRORS -->
<!--------------------------------------------------------------------->
<A NAME="REFERENCES">
<HR>
<H4>REFERENCES</H4>
<!-- BEGIN REFERENCES -->

     <I> The shortwave properties of liquid clouds come from: </I>

<PRE>
     Slingo, A., 1989: A GCM parameterization for the shortwave 
     radiative properties of water clouds. J. Atmos. Sci., vol. 46, 
     pp. 1419-1427.
</PRE>
     <I> The shortwave and longwave properties of ice clouds come from: </I>

<PRE>
     Ebert, E. E. and J. A. Curry, 1992: A parameterization of ice cloud
     optical properties for climate models. J. Geophys. Res., vol. 97,
     D1, pp. 3831-3836.
</PRE>
     <I> The longwave emissivity parameterization of liquid clouds comes 
         from: </I>
<PRE>
     Stephens, G. L., 1978: Radiation profiles in extended water clouds.
     II: Parameterization schemes. J. Atmos. Sci., vol. 35, 
     pp. 2123-2132.
</PRE>
     <I> The parameterization of liquid cloud effective radius comes from: </I>
<PRE>
     Martin, G. M., D. W. Johnson, and A. Spice, 1994: The measurement 
     and parameterization of effective radius of droplets in warm stratocumulus
     clouds. J. Atmos. Sci, vol 51, pp. 1823-1842.
</PRE>
     <I> The parameterization of ice cloud effective radius comes from: </I>
<PRE>
     Donner, L. J., C. J. Seman, B. J. Soden, R. S. Hemler, J. C. Warren,
     J. Strom, and K.-N. Liou, 1997: Large-scale ice clouds in the GFDL
     SKYHI general circulation model. J. Geophys. Res., vol. 102, D18,
     pp. 21,745-21,768.
</PRE>
     <I> The algorithm to reproduce the ISCCP satellite view of clouds comes from: </I>
<PRE>
     Klein, S. A., and C. Jakob, 1999: Validation and sensitivities of 
     frontal clouds simulated by the ECMWF model. Monthly Weather Review,
     127(10),  2514-2531.
</PRE>

</A><!-- END REFERENCES -->
<!--------------------------------------------------------------------->
<A NAME="PLANS">
<HR>
<H4>FUTURE PLANS</H4>
<!-- BEGIN PLANS -->
<PRE>

     The optical depth and particle size for every model level will
     become a diagnostic output field.


</PRE>
</A><!-- END PLANS -->
<!--------------------------------------------------------------------->

<HR>
</BODY>
</HTML>
